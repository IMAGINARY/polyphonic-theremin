!function(){function e(e){return e&&e.__esModule?e.default:e}function t(e,t,n,i){Object.defineProperty(e,t,{get:n,set:i,enumerable:!0,configurable:!0})}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){o(e,t,n[t])}))}return e}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function u(e){if(Array.isArray(e))return s(e)}function c(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function l(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function p(e){return u(e)||c(e)||h(e)||l()}var d,f,v,y={};function m(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function b(e){if(Array.isArray(e))return e}function g(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function O(e,t){return b(e)||c(e)||h(e,t)||g()}function P(e,t,n){var i=Math.log(t),r=i+(Math.log(n)-i)*e;return Math.exp(r)}function j(e,t){var n=t.getBoundingClientRect(),i=n.left,r=n.top,o=n.width,a=n.height,s=Math.max(0,Math.min(e.clientX-i,o)),u=Math.max(0,Math.min(e.clientY-r,a));return{x:s,y:u,relX:s/o,relY:u/a,width:o,height:a}}function C(e,t,n){e.style.transform="translate(".concat(t,"px, ").concat(n,"px)")}t(y,"ring",(function(){return d}),(function(e){return d=e})),t(y,"pane",(function(){return f}),(function(e){return f=e})),t(y,"pointer",(function(){return v}),(function(e){return v=e})),d="GmrByW_ring",f="GmrByW_pane",v="GmrByW_pointer";var T=window.AudioContext||window.webkitAudioContext;function w(e,t){var n=t.currentTime,i=e.value;e.cancelScheduledValues(n),e.value=i}var M={waveType:"square",gainMin:.01,gainMax:.3,frequencyMinHz:65,frequencyMaxHz:3e3,attackMs:10,releaseMs:200,updateMs:10,mute:!1},x=function(){"use strict";function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e),o(this,"_options",void 0),o(this,"toneObjects",void 0),o(this,"releasingToneObjects",void 0),o(this,"audioContext",void 0),o(this,"globalGain",void 0),this._options=a({},M,t),this.toneObjects=new Map,this.releasingToneObjects=new Set,this.audioContext=new T,this.globalGain=this.audioContext.createGain(),this.globalGain.gain.value=0,this.globalGain.connect(this.audioContext.destination),this.applyMute()}return r(e,[{key:"getOptions",value:function(){return a({},this._options)}},{key:"applyOptions",value:function(e){Object.assign(this._options,e),this.applyMute(),this.refresh()}},{key:"getToneData",value:function(){var e=p(this.toneObjects.entries()).map((function(e){var t,n=O(e,2),i=n[0],r=n[1];return[i,(t=r,{tGain:t.tGain,tFrequency:t.tFrequency})]}));return new Map(e)}},{key:"size",get:function(){return this.toneObjects.size}},{key:"createTone",value:function(){var e=this.audioContext.createGain();e.gain.value=0,e.connect(this.globalGain);var t=this.audioContext.createGain();t.connect(e);var n=this._options.waveType,i=this.audioContext.createOscillator();return i.type=n,i.connect(t),i.start(),{envelopeGainNode:e,gainNode:t,oscillatorNode:i}}},{key:"getToneParams",value:function(e,t){var n,i=this._options,r=i.gainMin,o=i.gainMax,a=(n=r)+(o-n)*e,s=this._options;return{gain:a,frequency:P(t,s.frequencyMinHz,s.frequencyMaxHz)}}},{key:"add",value:function(e,t,n){var i=this.createTone(),r=i.envelopeGainNode,o=i.gainNode,s=i.oscillatorNode,u=this.getToneParams(t,n),c=u.gain,l=u.frequency,h=this._options.attackMs,p=this.audioContext.currentTime+h/1e3;r.gain.linearRampToValueAtTime(1,p),o.gain.value=c,s.frequency.value=l,this.remove(e);var d=m(a({},i),{tGain:t,tFrequency:n});return this.toneObjects.set(e,d),d}},{key:"update",value:function(e,t,n){this.audioContext.resume().catch((function(){}));var i=this.toneObjects.get(e);i&&(i.tGain=t,i.tFrequency=n,this.refreshNodes(i))}},{key:"refreshNodes",value:function(e){var t,n=e.tGain,i=e.tFrequency,r=this.getToneParams(n,i),o=r.gain,a=r.frequency,s=e.gainNode,u=e.oscillatorNode,c=this._options.updateMs,l=this.audioContext.currentTime+c/1e3,h=s.gain,p=u.frequency;w(h,this.audioContext),w(p,this.audioContext),h.linearRampToValueAtTime(o,l),(null!==(t=p.exponentialRampToValueAtTime.bind(p))&&void 0!==t?t:p.linearRampToValueAtTime.bind(p))(a,l)}},{key:"remove",value:function(e){var t=this,n=this.toneObjects.get(e);if(n){var i=n.envelopeGainNode,r=n.gainNode,o=n.oscillatorNode,a=this._options.releaseMs,s=this.audioContext.currentTime+a/1e3;i.gain.linearRampToValueAtTime(0,s),setTimeout((function(){i.disconnect(),r.disconnect(),o.stop(),o.disconnect(),t.releasingToneObjects.delete(n),0===t.toneObjects.size+t.releasingToneObjects.size&&t.audioContext.suspend().catch((function(){}))}),a),this.toneObjects.delete(e),this.releasingToneObjects.add(n)}}},{key:"refresh",value:function(){var e=this;p(this.toneObjects.values()).forEach((function(t){return e.refreshNodes(t)}))}},{key:"applyMute",value:function(){var e=this.audioContext.currentTime,t=this.globalGain.gain,n=e+.02,i=this._options.mute?0:1;w(t,this.audioContext),t.linearRampToValueAtTime(i,n)}}]),e}(),k=x,E={touchElementCssClasses:[e(y).ring],touchElementStyle:""};function A(t,n){return t.querySelectorAll(".".concat(e(y).pointer,'[data-pointer-id="').concat(n,'"]'))}var N=function(){"use strict";function t(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n(this,t),o(this,"_options",void 0),o(this,"tones",void 0),o(this,"handlers",this.getHandlers()),o(this,"element",void 0),o(this,"pane",void 0),this._options=a({},E,r);var u=document.createElement("div");for(u.classList.add(e(y).pane),u.addEventListener("pointerdown",this.handlers.addPointer),u.addEventListener("pointerup",this.handlers.removePointer),u.addEventListener("pointercancel",this.handlers.removePointer),u.addEventListener("contextmenu",(function(e){return e.preventDefault()}));i.firstChild;)i.firstChild.remove();i.appendChild(u),this.pane=u,this.element=i,this.tones=new k(s)}return r(t,[{key:"getOptions",value:function(){return a({},this._options)}},{key:"applyOptions",value:function(e){Object.assign(this._options,e),this.refreshPointerElementCssAll()}},{key:"getToneOptions",value:function(){return this.tones.getOptions()}},{key:"applyToneOptions",value:function(e){this.tones.applyOptions(e)}},{key:"getHandlers",value:function(){return{addPointer:this.addPointer.bind(this),updatePointer:this.updatePointer.bind(this),removePointer:this.removePointer.bind(this)}}},{key:"addPointer",value:function(t){this.removePointer(t),this.pane.addEventListener("pointermove",this.handlers.updatePointer),this.pane.setPointerCapture(t.pointerId);var n=j(t,this.pane),i=n.relX,r=n.relY,o=document.createElement("div");this.refreshPointerElementCss(o);var a=document.createElement("div");a.classList.add(e(y).pointer),a.dataset.pointerId="".concat(t.pointerId),a.appendChild(o),this.pane.append(a),this.tones.add(t.pointerId,i,r),this.updatePointer(t)}},{key:"updatePointer",value:function(e){if(0!==e.buttons){var t=e.pointerId,n=A(this.pane,t),i=j(e,this.pane),r=i.x,o=i.y,a=i.relX,s=i.relY;n.forEach((function(e){return C(e,r,o)})),this.tones.update(t,a,s)}}},{key:"removePointer",value:function(e){var t=e.pointerId;A(this.pane,t).forEach((function(e){return e.remove()})),this.pane.releasePointerCapture(e.pointerId),this.tones.remove(t),0===this.tones.size&&this.pane.removeEventListener("pointermove",this.handlers.updatePointer)}},{key:"refreshPointerElementCss",value:function(e){var t,n=this._options,i=n.touchElementCssClasses,r=n.touchElementStyle;(t=e.classList).add.apply(t,p(i)),e.setAttribute("style",r)}},{key:"refreshPointerElementCssAll",value:function(){this.pane.querySelectorAll(".".concat(e(y).pointer," > *")).forEach(this.refreshPointerElementCss.bind(this))}}]),t}(),_=N;function q(e,t,n,i){var r=n.dataset[t];void 0!==r&&(e[t]=i(r))}document.querySelectorAll('*[data-component="muski-theremin"]').forEach((function(e){var t=q,n={};t(n,"touchElementCssClasses",e,(function(e){return e.split(" ")})),t(n,"touchElementStyle",e,(function(e){return e}));var i={};t(i,"waveType",e,(function(e){return e})),t(i,"gainMin",e,Number.parseFloat),t(i,"gainMax",e,Number.parseFloat),t(i,"frequencyMinHz",e,Number.parseFloat),t(i,"frequencyMaxHz",e,Number.parseFloat),t(i,"attackMs",e,Number.parseFloat),t(i,"releaseMs",e,Number.parseFloat),t(i,"updateMs",e,Number.parseFloat),t(i,"mute",e,(function(e){return!0})),new _(e,n,i)}))}();
//# sourceMappingURL=muski-theremin.min.js.map
