{"mappings":"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","sources":["src/lib/ts/index.ts","index.ts","src/lib/ts/polyphonic-theremin.ts","<<jsx-config-pragma.js>>","polyphonic-theremin.ts","src/lib/ts/tones.ts","tones.ts","src/lib/ts/util.ts","util.ts"],"sourcesContent":["import PolyphonicTheremin from './polyphonic-theremin';\n\nexport default PolyphonicTheremin;\n",null,"import classes from '../scss/polyphonic-theremin.module.scss';\nimport Tones, { ToneOptions } from './tones';\nimport { getRelativePointerPosition, setPosition } from './util';\n\ntype PolyphonicThereminOptions = ToneOptions;\n\nfunction queryForPointerIdAll<T extends Element>(\n  parent: Element,\n  id: number,\n): NodeListOf<T> {\n  return parent.querySelectorAll<T>(\n    `.${classes.pointer}[data-pointer-id=\"${id}\"]`,\n  );\n}\n\nexport default class PolyphonicTheremin {\n  protected tones: Tones;\n\n  protected handlers = this.getHandlers();\n\n  protected element: Element;\n\n  protected pane: HTMLDivElement;\n\n  constructor(\n    element: Element,\n    options: Partial<PolyphonicThereminOptions> = {},\n  ) {\n    const pane = document.createElement('div');\n    pane.classList.add(classes.pane);\n    pane.addEventListener('pointerdown', this.handlers.addPointer);\n    pane.addEventListener('pointerup', this.handlers.removePointer);\n    pane.addEventListener('pointercancel', this.handlers.removePointer);\n    pane.addEventListener('contextmenu', (event) => event.preventDefault());\n\n    while (element.firstChild) element.firstChild.remove();\n    element.appendChild(pane);\n\n    this.pane = pane;\n    this.element = element;\n\n    this.tones = new Tones(options);\n  }\n\n  get options() {\n    return this.tones.options;\n  }\n\n  protected getHandlers() {\n    return {\n      addPointer: this.addPointer.bind(this),\n      updatePointer: this.updatePointer.bind(this),\n      removePointer: this.removePointer.bind(this),\n    };\n  }\n\n  addPointer(pe: PointerEvent) {\n    this.removePointer(pe);\n    this.pane.addEventListener('pointermove', this.handlers.updatePointer);\n\n    this.pane.setPointerCapture(pe.pointerId);\n\n    const { relX, relY } = getRelativePointerPosition(pe, this.pane);\n\n    const internalElem = document.createElement('div');\n    const elem = document.createElement('div');\n    elem.classList.add(classes.pointer);\n    elem.dataset.pointerId = `${pe.pointerId}`;\n    elem.appendChild(internalElem);\n\n    this.pane.append(elem);\n\n    this.tones.add(pe.pointerId, relX, relY);\n\n    this.updatePointer(pe);\n  }\n\n  updatePointer(pe: PointerEvent) {\n    if (pe.buttons === 0) return;\n\n    const id = pe.pointerId;\n    const elems = queryForPointerIdAll<HTMLElement>(this.pane, id);\n    const { x, y, relX, relY } = getRelativePointerPosition(pe, this.pane);\n    elems.forEach((e) => setPosition(e, x, y));\n    this.tones.update(id, relX, relY);\n  }\n\n  removePointer(pe: PointerEvent) {\n    const id = pe.pointerId;\n    const elems = queryForPointerIdAll<HTMLElement>(this.pane, id);\n    elems.forEach((e) => e.remove());\n    this.pane.releasePointerCapture(pe.pointerId);\n\n    this.tones.remove(id);\n\n    if (this.tones.size)\n      this.pane.removeEventListener('pointermove', this.handlers.updatePointer);\n  }\n}\n",null,null,"import {\n  hasKey,\n  interpolateLinear,\n  interpolateLogarithmic,\n  AudioContext,\n} from './util';\n\ninterface ToneData {\n  tGain: number;\n  tFrequency: number;\n}\n\ninterface ToneDataWithNodes extends ToneData {\n  envelopeGainNode: GainNode;\n  gainNode: GainNode;\n  oscillatorNode: OscillatorNode;\n}\n\nfunction extractToneData<T extends ToneData>(toneDataExt: T): ToneData {\n  const { tGain, tFrequency } = toneDataExt;\n  return {\n    tGain,\n    tFrequency,\n  };\n}\n\ntype ToneOptions = {\n  waveType: OscillatorType;\n  gainMin: number;\n  gainMax: number;\n  frequencyMinHz: number;\n  frequencyMaxHz: number;\n  attackMs: number;\n  releaseMs: number;\n  updateMs: number;\n};\n\nconst defaultToneOptions: Readonly<ToneOptions> = {\n  waveType: 'square',\n  gainMin: 0.01,\n  gainMax: 0.3,\n  frequencyMinHz: 65,\n  frequencyMaxHz: 3000,\n  attackMs: 10,\n  releaseMs: 200,\n  updateMs: 10,\n};\n\nclass Tones {\n  public readonly options: ToneOptions;\n\n  protected toneObjects: Map<number, ToneDataWithNodes>;\n\n  protected audioContext: AudioContext;\n\n  protected needsRefresh: boolean;\n\n  constructor(options: Partial<ToneOptions> = {}) {\n    const optionsWithDefaults = { ...defaultToneOptions, ...options };\n    this.options = new Proxy<ToneOptions>(optionsWithDefaults, {\n      set: (target: typeof optionsWithDefaults, key, newValue): boolean => {\n        // The TypeScript compiler already enforces the correct type on the Proxy level,\n        // so the following assignment is safe even if we can't determine the type of\n        // `newValue` statically.\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment,no-param-reassign\n        target[key] = newValue;\n        if (hasKey(optionsWithDefaults, key)) {\n          // update tones\n          console.log('Update!!');\n          this.scheduleRefresh();\n        }\n        return true;\n      },\n    });\n\n    this.toneObjects = new Map();\n    this.audioContext = new AudioContext();\n    this.needsRefresh = false;\n  }\n\n  getToneData(): Map<number, ToneData> {\n    const convertEntries = ([id, t]: [id: number, t: ToneDataWithNodes]): [\n      number,\n      ToneData,\n    ] => [id, extractToneData(t)];\n    const entriesExt = [...this.toneObjects.entries()];\n    const entries = entriesExt.map(convertEntries);\n    return new Map(entries);\n  }\n\n  get size() {\n    return this.toneObjects.size;\n  }\n\n  createTone() {\n    // create envelope Gain node\n    const envelopeGainNode = this.audioContext.createGain();\n    envelopeGainNode.gain.value = 0;\n    envelopeGainNode.connect(this.audioContext.destination);\n\n    // create Gain node\n    const gainNode = this.audioContext.createGain();\n    gainNode.connect(envelopeGainNode);\n\n    // create variable-frequency Oscillator node\n    const { waveType } = this.options;\n    const oscillatorNode = this.audioContext.createOscillator();\n    oscillatorNode.type = waveType;\n    oscillatorNode.connect(gainNode);\n    oscillatorNode.start();\n\n    return {\n      envelopeGainNode,\n      gainNode,\n      oscillatorNode,\n    };\n  }\n\n  getToneParams(tGain: number, tFrequency: number) {\n    const { gainMin, gainMax } = this.options;\n    const gain = interpolateLinear(tGain, gainMin, gainMax);\n    const { frequencyMinHz, frequencyMaxHz } = this.options;\n    const frequency = interpolateLogarithmic(\n      tFrequency,\n      frequencyMinHz,\n      frequencyMaxHz,\n    );\n    return { gain, frequency };\n  }\n\n  add(id: number, tGain: number, tFrequency: number): ToneData {\n    const tone = this.createTone();\n    const { envelopeGainNode, gainNode, oscillatorNode } = tone;\n    const { gain, frequency } = this.getToneParams(tGain, tFrequency);\n    const { attackMs } = this.options;\n    const attackTimestamp = this.audioContext.currentTime + attackMs / 1000;\n    envelopeGainNode.gain.linearRampToValueAtTime(1.0, attackTimestamp);\n    gainNode.gain.value = gain;\n    oscillatorNode.frequency.value = frequency;\n\n    this.remove(id);\n\n    const toneData = { ...tone, tGain, tFrequency };\n    this.toneObjects.set(id, toneData);\n\n    return toneData;\n  }\n\n  update(id: number, tGain: number, tFrequency: number) {\n    this.audioContext.resume().catch(() => {});\n\n    const toneDataWithNodes = this.toneObjects.get(id);\n    if (!toneDataWithNodes) return;\n\n    toneDataWithNodes.tGain = tGain;\n    toneDataWithNodes.tFrequency = tFrequency;\n    this.refreshNodes(toneDataWithNodes);\n  }\n\n  protected refreshNodes(toneDataWithNodes: ToneDataWithNodes) {\n    const { tGain, tFrequency } = toneDataWithNodes;\n    const { gain, frequency } = this.getToneParams(tGain, tFrequency);\n    const { gainNode, oscillatorNode } = toneDataWithNodes;\n    const { updateMs } = this.options;\n    if (updateMs <= 0) {\n      gainNode.gain.value = gain;\n      oscillatorNode.frequency.value = frequency;\n    } else {\n      const updateDoneTimestamp =\n        this.audioContext.currentTime + updateMs / 1000.0;\n      gainNode.gain.linearRampToValueAtTime(gain, updateDoneTimestamp);\n      oscillatorNode.frequency.linearRampToValueAtTime(\n        frequency,\n        updateDoneTimestamp,\n      );\n    }\n  }\n\n  remove(id: number) {\n    const toneData = this.toneObjects.get(id);\n    if (!toneData) return;\n\n    const { envelopeGainNode, gainNode, oscillatorNode } = toneData;\n    const { releaseMs } = this.options;\n    const decayTimestamp = this.audioContext.currentTime + releaseMs / 1000;\n    envelopeGainNode.gain.linearRampToValueAtTime(0.0, decayTimestamp);\n    setTimeout(() => {\n      gainNode.disconnect();\n      oscillatorNode.stop();\n      oscillatorNode.disconnect();\n    }, releaseMs);\n\n    this.toneObjects.delete(id);\n  }\n\n  refresh() {\n    [...this.toneObjects.values()].forEach((t) => this.refreshNodes(t));\n  }\n\n  scheduleRefresh() {\n    this.needsRefresh = true;\n    this.needsRefresh = true;\n    queueMicrotask(() => this.refreshIfNeeded());\n  }\n\n  refreshIfNeeded(): boolean {\n    if (this.needsRefresh) {\n      this.refresh();\n      return true;\n    }\n\n    return false;\n  }\n}\n\nexport { ToneOptions, defaultToneOptions };\nexport default Tones;\n",null,"function hasKey<T extends object>(obj: T, k: keyof never): k is keyof T {\n  return k in obj;\n}\n\nfunction interpolateLinear(t: number, min: number, max: number) {\n  return min + (max - min) * t;\n}\n\nfunction interpolateLogarithmic(t: number, min: number, max: number) {\n  // The base of the logarithm cancels out during the computation,\n  // so we will just use any base, e.g. Euler's number.\n  const logMin = Math.log(min);\n  const logMax = Math.log(max);\n  const logValue = logMin + (logMax - logMin) * t;\n  return Math.exp(logValue);\n}\n\nfunction getRelativePointerPosition(pe: PointerEvent, elem: HTMLElement) {\n  const { left, top, width, height } = elem.getBoundingClientRect();\n  const x = Math.max(0, Math.min(pe.clientX - left, width));\n  const y = Math.max(0, Math.min(pe.clientY - top, height));\n  const relX = x / width;\n  const relY = y / height;\n  return { x, y, relX, relY, width, height };\n}\n\nfunction setPosition(element: HTMLElement, x: number, y: number) {\n  const { style } = element;\n  style.left = `${x}px`;\n  style.top = `${y}px`;\n}\n\nconst AudioContext = window.AudioContext || window.webkitAudioContext;\n\nexport {\n  hasKey,\n  interpolateLinear,\n  interpolateLogarithmic,\n  getRelativePointerPosition,\n  setPosition,\n  AudioContext,\n};\n",null],"names":[],"version":3,"file":"index.js.map"}